---
title: "titel "
author: "my_name"
date: "`r Sys.Date()`"

header-includes:
   - \usepackage{longtable}
   - \usepackage{hyperref}
output:
    pdf_document:
      number_sections: yes
linkcolor: blue
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
Introduction of the research and introduction research questions

## Goal
  - Describe Goal (not the educational goal but the research goal)
  - Describe how you reach the goal (e.g. make model and figures, use different setting)
  - formulate hypothesis

## Theory

- Describe biological model
- Picture of the biological model

```{r, echo=FALSE, out.width='95%'}
#knitr::include_graphics('example.png')
```
Give an explanation of the model with citations of source \cite{Soertaert10} (replace this with actual source)
and formula explanation

$$\frac{\delta R}{\delta t} = -r * R + m $$
Describe each element and the transformations

# Methods

## The software model

- Describe the software tools used, as well as the libraries
- Describe the software implementation (note: code below is an example)

### Assignment 1

```{r}
library(deSolve)
# code
```

```{r}
# Definiëren van de parameters
parameters <- c(Ks_Rm = 2.90, IC50_Rm = 26.2, 
                Kon = 0.00329, KT = 0.63, 
                Kre = 0.57, RF = 0.49, 
                Kd_R = 0.0572, Kd_Rm = 0.612, 
                Ksr = 3.22)

D <- 53.4

# Tijdspunten definiëren
times <- 0 : 48

# Het definiëren van de initiële waardes
initial.values <- c(DR_N = 0, mRNAr = 4.74, R = 267, DR = 0)
```

```{r}
verandering_dt <- function (time, parameters, initial.values, D) {
  with(as.list(c(parameters, initial.values)),{
    # Vergelijking van mRNAr
    mRNAr.dt <- Ks_Rm * (1 - (DR_N / (IC50_Rm + DR_N))) - Kd_Rm * mRNAr
    # Vergelijking van R
    R.dt <- Ksr * mRNAr + RF * Kre * DR_N - Kon * D * R - Kd_R * R
    # Vergelijking van DR
    DR.dt <- Kon * D * R - KT * DR
    # Vergelijking van DR(N)
    DR_N.dt <- KT * DR - Kre * DR_N
    
    # Retourneren van de initiële waardes
    return(list(c(DR_N.dt, mRNAr.dt, R.dt, DR.dt)))
  })
}

# Het aanroepen van de ode functie, waardes worden opgeslagen
verloop.dataset <- ode(initial.values, times, verandering_dt, parameters, D = D)
```

```{r}
legend.graph <- function(){
  return(
    legend("topright", 
       legend = c("Model", "Median 0.1", "Median 0.3", "Experiment"),
       col = c("#21A9AD", "darkred", "darkgreen", "grey"),
       pch = c(NA, NA, NA, 1),
       lwd = c(2, 2, 2, NA)
       )
  )
}
```


```{r}
experiment.data <- read.csv("../MPL.csv", header = T, sep = ",")
medians <- aggregate(experiment.data[,c("MPL_conc","mRNA","Free_receptor")],
                     list(experiment.data$dose,experiment.data$time),
                     median, na.rm=TRUE)

names(medians)[1:2] <- c("dose","time")

# mRNA plot - experiment - model
plot(verloop.dataset[,"mRNAr"], type="l", xlab="Time", ylab="mRNAr", lwd = 2, ylim = c(0, 8), xlim = c(0, 150), col = "#21A9AD")
lines(medians$mRNA[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], type = "l", lwd = 2, col = "darkred")
lines(medians$mRNA[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], type = "l", lwd = 2, col = "darkgreen")
points(experiment.data$mRNA, col = "black", pch = 1, cex = .7)

legend.graph()

# Free receptor R plot - experiment - model
plot(verloop.dataset[,"R"], type="l", xlab="Time", ylab="mRNAr", lwd = 2, ylim = c(0, 500), xlim = c(0, 150), col = "#21A9AD")
lines(medians$Free_receptor[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], type = "l", lwd = 2, col = "darkred")
lines(medians$Free_receptor[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], type = "l", lwd = 2, col = "darkgreen")
points(experiment.data$Free_receptor, col = "black", pch = 1, cex = .7)

legend.graph()

# Nieuwe data met andere Dosis (D)
verloop.dataset.lage.doses <- ode(initial.values, times, verandering_dt, parameters, D = 39)
verloop.dataset.hoge.doses <- ode(initial.values, times, verandering_dt, parameters, D = 107)
```

```{r}
par(mfrow = c(1,2))
plot(verloop.dataset.lage.doses[,"mRNAr"],
     main = "mRNAr met lage dosis",
     type="l", xlab="Time", ylab="mRNAr", 
     lwd = 2, xlim = c(0, 150), ylim = c(0, 8), col = "#21A9AD")

lines(medians$mRNA[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], type = "l", lwd = 2, col = "darkred")
lines(medians$mRNA[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], type = "l", lwd = 2, col = "darkgreen")
points(experiment.data$mRNA, col = "black", pch = 1, cex = .7)

legend.graph()

plot(verloop.dataset.hoge.doses[,"mRNAr"], 
     main = "mRNAr met hoge dosis",
     type="l", xlab="Time", ylab="Free receptor", lwd = 2, xlim = c(0, 150), ylim = c(0, 8), col = "#21A9AD")

lines(medians$mRNA[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], type = "l", lwd = 2, col = "darkred")
lines(medians$mRNA[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], type = "l", lwd = 2, col = "darkgreen")
points(experiment.data$mRNA, col = "black", pch = 1, cex = .7)

legend.graph()
```

```{r}
par(mfrow = c(1,2))
plot(verloop.dataset.lage.doses[,"R"],
     main = "Free receptor (R) met lage dosis",
     type="l", xlab="Time", 
     ylab="Free receptor", 
     lwd = 2, xlim = c(0, 140), 
     ylim = c(0, 500), 
     col = "#21A9AD")

lines(medians$Free_receptor[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], 
      type = "l", 
      lwd = 2, 
      col = "darkred")

lines(medians$Free_receptor[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], 
      type = "l", 
      lwd = 2, 
      col = "darkgreen")

points(experiment.data$Free_receptor, 
       col = "black", 
       pch = 1, 
       cex = .7)

points(medians$MPL_conc[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], lwd = 2, col = "orange")

legend.graph()

plot(verloop.dataset.hoge.doses[,"R"],
     main = "Free receptor (R) met hoge dosis",
     type="l", 
     xlab="Time", 
     ylab="Free receptor", 
     lwd = 2, xlim = c(0, 140), 
     ylim = c(0, 500), 
     col = "#21A9AD")

lines(medians$Free_receptor[medians$dose == 0.1] ~ medians$time[medians$dose == 0.1], 
      type = "l", 
      lwd = 2, col = "darkred")

lines(medians$Free_receptor[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], 
      type = "l", 
      lwd = 2, 
      col = "darkgreen")

points(experiment.data$Free_receptor, 
       col = "black", 
       pch = 1, 
       cex = .7)

points(medians$MPL_conc[medians$dose == 0.3] ~ medians$time[medians$dose == 0.3], lwd = 1, col = "orange", type = "b")

legend.graph()
```

### Assignment 2

```{r}
# Definiëren van de parameters
parameters <- c(Ks_Rm = 2.90, IC50_Rm = 26.2, 
                Kon = 0.00329, KT = 0.63, 
                Kre = 0.57, RF = 0.49, 
                Kd_R = 0.0572, Kd_Rm = 0.612, 
                Ksr = 3.22)

# Tijdspunten definiëren
times <- 0 : 48

# Het definiëren van de initiële waardes
initial.values <- c(DR_N = 0, mRNAr = 4.74, R = 267, DR = 0)

verandering_dt <- function (time, parameters, initial.values, D) {
  with(as.list(c(parameters, initial.values)),{
    # Vergelijking van mRNAr
    mRNAr.dt <- Ks_Rm * (1 - (DR_N / (IC50_Rm + DR_N))) - Kd_Rm * mRNAr
    # Vergelijking van R
    R.dt <- Ksr * mRNAr + RF * Kre * DR_N - Kon * D * R - Kd_R * R
    # Vergelijking van DR
    DR.dt <- Kon * D * R - KT * DR
    # Vergelijking van DR(N)
    DR_N.dt <- KT * DR - Kre * DR_N
    
    # Retourneren van de initiële waardes
    return(list(c(DR_N.dt, mRNAr.dt, R.dt, DR.dt)))
  })
}

D <- 53.4

# Het aanroepen van de ode functie, waardes worden opgeslagen
verloop.dataset.stop <- ode(initial.values, times, verandering_dt, parameters, D = D)

# 35/40
```

```{r}
# Kon / 5
parameters["Kon"] = 0.00329 / 5
dataset.kon.g5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kon / 2
parameters["Kon"] = 0.00329 / 2
dataset.kon.g2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kon * 5
parameters["Kon"] = 0.00329 * 5
dataset.kon.k5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kon * 2
parameters["Kon"] = 0.00329 * 2
dataset.kon.k2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre variabele
# Kre / 5
parameters["Kre"] = 0.57 / 5
dataset.kre.g5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre / 2
parameters["Kre"] = 0.57 / 2
dataset.kre.g2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre * 5
parameters["Kre"] = 0.57 * 5
dataset.kre.k5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre * 2
parameters["Kre"] = 0.57 * 2
dataset.kre.k2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

```

```{r}
plot(verloop.dataset, main = "Normale model")

# Stel de datasetnamen in een lijst
dataset_list <- list(dataset.kon.g5, dataset.kon.g2, dataset.kon.k5, dataset.kon.k2, dataset.kre.g5, dataset.kre.g2, dataset.kre.k5, dataset.kre.k2)

# Stel de plotlabels in een lijst
label_list <- c("mRNAr Kon / 5", "DR_ N Kon / 5", "mRNAr Kon / 2", "DR_ N Kon / 2", "mRNAr Kon * 5", "DR_ N Kon * 5", "mRNAr Kon * 2", "DR_ N Kon * 2",
                "mRNAr Kre / 5", "DR_ N Kre / 5", "mRNAr Kre / 2", "DR_ N Kre / 2", "mRNAr Kre * 5", "DR_ N Kre * 5", "mRNAr Kre * 2", "DR_ N Kre * 2")

par(mfrow = c(2, 4))

# Maak een lus om de plots te maken voor elke dataset
for (i in 1:length(dataset_list)) {
  plot(dataset_list[[i]][, "mRNAr"], type = "l", main = label_list[2*i-1])
  plot(dataset_list[[i]][, "DR_N"], type = "l", main = label_list[2*i])
}

```





## Model configuration

Explain chosen initial state, parameter values and time sequence. Use tables with values as for example below
\begin{longtable}[l]{l|l|l}
\caption{Parameter Values} \\ \hline
\label{param_table}
$\textbf{Parameter}$             &$\textbf{Value}$& $\textbf{Unit}$              \\ \hline
\endhead
$a$       & 0.08  & $hour^{-1}$         \\ \hline
$b$       & 0.06  & $hour^{-1}$         \\ \hline
$c$       & 0.06  & $hour^{-1}$         \\ \hline
\end{longtable}


# Results
Introduction of results, how does it answer your research questions.
```{r}
#plot(out)
#code to generate figures with title, subscripts, legenda etc
```

- Describe what can be seen in such way that it leads to an answer to your research questions
- Give your figures a number and a descriptive title.
- Provide correct axis labels (unit and quantity), legend and caption.
- Always refer to and discuss your figures and tables in the text - they never stand alone.


# Discussion and Conclusion
## Discussion
- Compare your results with what is expecting from the literature and discuss differences with them.
- Discuss striking and surprising results.
- Discuss weaknesses in your research and how they could be addressed.

## General conclusion and perspective
Discuss what your goal was, what the end result is and how you could continue working from here.


\begin{thebibliography}{9}

\bibitem{Soertaert10}
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R.: \textit{Solving differential equations in R: package deSolve}, J. Stat. Softw., 33, 1-25, 2010.

\end{thebibliography}
