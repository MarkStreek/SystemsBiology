---
title: "Glucocorticoid receptor, a closer look"
author: "L T Stein & M van de Streek"
date: "`r Sys.Date()`"

header-includes:
   - \usepackage{longtable}
   - \usepackage{hyperref}
output:
    pdf_document:
      number_sections: yes
linkcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\pagebreak

\tableofcontents

\pagebreak

# Afkortingen 

glucocorticoïdereceptor (GR); methylprednisolon (MPL); receptor (R);
MPL (D); MPL-receptor complex (DR); geactiveerd of in de celkern MPL-receptor complex (DR_N);

\pagebreak

# Introductie

In dit verslag zal er nader gekeken worden naar de werking van glucocorticosteroïden. Er zal worden gekeken naar de dynamica hiervan. Het model wat gebruikt wordt, zal nader worden uitglegd in de theorie. De belangrijkste termen die hier voorbij zullen komen worden alvast kort uitgelegd. 

Glucocorticosteroïden (D) zijn hormonen die worden geproduceerd in de bijnierschors. Het is een samenstelling van glucose, cortex en steroïde. glucocorticosteroïden worden ook vaak gebruikt in de remming van ontstekingen. De glucocorticosteroïden binden aan receptoren (R), er ontstaat dan een glucocorticoïdereceptorcomplex (DR). Dit complex verplaatst naar de celkern en bindt hier aan het DNA (DR_N). De transcriptie van genen die ontstekingen veroorzaken worden tegengehouden door de complexen. Tegelijkertijd worden de genen die ontsteking remmen juist gepromoveerd. Er komen dus meer eiwitten die de ontsteking onderdrukken.

Bij het onderzoek zal gebruik gemaakt worden van experimentele data. Deze data is afkomstig van ratten. De ratten zijn zeven dagen lang geinfecteerd met methylprednisolone (een vorm van een glucocorticosteroïde). De ratten zijn geïnfecteerd met twee verschillende doses: 0.1 en 0.3 mg drug/kg rat/h. Hierover zal meer verteld worden in de theorie. 

Bij het nader kijken wordt er bedoelt dat er aantal situaties worden uitgewerkt. Denk hierbij bijvoorbeeld aan: wat gebeurt er met het systeem als ik een constante vijf keer zo groot maak? Ook wordt er gekeken naar het verloop van het systeem bij een doseringstop na een bepaalde tijd. Al deze situaties worden vergeleken met de experimentele data.

## Doel
  
Het doel van dit onderzoek is om erachter te komen welke elementen belangrijk zijn in het model. Dus de elementen die van grote invloed zijn op bepaalde waardes. Aan de hand hiervan kan er ook iets gezegd worden over de hoeveelheid drug die kan toe worden gediend.

Dit doel kan bereikt worden door aanpassingen te doen aan het model en vervolgens te simuleren. Deze simulaties kunnen vergeleken worden met de experimentele data. Aan de hand hiervan kan worden vastgesteld of een aanpassing/weglating van een element in het model van grote invloed is.

De verwachting van het onderzoek is breed. Er zijn een aantal verwachtingen bij het model. Allereerst wordt er verwacht dat het aantal receptoren een belangrijke factor zal zijn. Hier bindt de drug aan en zal dus belangrijk zijn. Verder zal ook het aantal drug een belangrijke rol spelen. Zoals eerder vermeld werden de ratten geïnfecteerd met een dosis van 0.1 (laag) en 0.3 (hoog). De verwachting is dat ergens tussen deze waarden een ideale dosering ligt. 

## Theorie

    - Describe biological model
    - Picture of the biological model

    ```{r, echo=FALSE, out.width='95%'}
    #knitr::include_graphics('example.png')
    ```

    Give an explanation of the model with citations of source \cite{Soertaert10} (replace this with actual source)
    and formula explanation

    $$\frac{\delta R}{\delta t} = -r * R + m $$
    Describe each element and the transformations

# Methode

## Het software model

    - Describe the software tools used, as well as the libraries
    - Describe the software implementation (note: code below is an example)
    
Om de dynamica van de systemen eenvoudig weer te geven, moeten de differentiaal vergelijkingen worden uitgevoerd met verschillende waardes. Dit zal gedaan worden met het deSolve pakket \cite{deSolve} (versie 1.35) in R (versie 4.2.2). 

Er worden twee scenario's behandeld. Er wordt allereerst gekeken naar de validiteit van het model. Vervolgens zal er naar simulatie scenario's worden gekeken, d.w.z. wat gebeurt er met het systeem als een waarde wordt aangepast of weggelaten?

```{r}
# Inladen van het deSolve pakket
library(deSolve)
```

```{r}
# Inladen van de experiment data
experiment.data <- read.csv("../MPL.csv", header = T, sep = ",")
medians <- aggregate(experiment.data[,c("MPL_conc","mRNA","Free_receptor")],
                     list(experiment.data$dose,experiment.data$time),
                     median, na.rm=TRUE)

# Goede namen geven aan de kolommen
names(medians)[1:2] <- c("dose","time")
```

Onderstaand een functie die wordt gebruikt voor een legenda bij elke grafiek.

```{r}
legend.graph <- function(){
  return(
    legend("topright", 
       legend = c("Model", "Median 0.1", "Median 0.3", "Experiment"),
       col = c("#21A9AD", "darkred", "darkgreen", "grey"),
       pch = c(NA, NA, NA, 1),
       lwd = c(2, 2, 2, NA)
       )
  )
}
```

Functie die de verandering berekend. Deze zal worden gebruikt voor scenario één.

```{r}
verandering_dt <- function (time, parameters, initial.values, D) {
  with(as.list(c(parameters, initial.values)),{
    # Vergelijking van mRNAr
    mRNAr.dt <- Ks_Rm * (1 - (DR_N / (IC50_Rm + DR_N))) - Kd_Rm * mRNAr
    # Vergelijking van R
    R.dt <- Ksr * mRNAr + RF * Kre * DR_N - Kon * D * R - Kd_R * R
    # Vergelijking van DR
    DR.dt <- Kon * D * R - KT * DR
    # Vergelijking van DR(N)
    DR_N.dt <- KT * DR - Kre * DR_N
    
    # Retourneren van de initiële waardes
    return(list(c(DR_N.dt, mRNAr.dt, R.dt, DR.dt)))
  })
}
```

## Model configuratie

    Explain chosen initial state, parameter values and time sequence. Use tables with values as for example below
    
```{r}
# Pakket inladen voor mooiere tabel
library(pander)
```

Tabel 1: *Variabelen betrokken bij opzetten experiment opgedeeld in zeven konstantes, drie parameters en vier initiële waarden.*
          
```{r}
# Drie categorieën aan soorten input waarden
Categorie <- c(rep("Initiële waarden", 4), 
               rep("Parameters", 10))

# Waarden uit bovenstaande categorieën verkregen van experiment
# Omdat DR een reactie is tussen D en R gaan de waarden keer elkaar
Waarden<- c("mRNAr"=4.74, "DR_N"=0, "R"=267, "DR"=0, "ks_Rm"=2.90, 
          "kd_Rm"= 0.612, "k_re"=0.57, "k_T"=0.63,  "k_on"= 0.00329, 
          "k_d_R"=0.0572, "k_s_r"=3.22, "IC50_Rm"=26.2, "RF"=0.49, "D"=53.4)

# Eenheden in een vector verwerkt. Met functie 'rep()' kan een iterable X
# keer herhaald worden.
Eenheden <- c("fmol / g liver", rep("fmol/mg protein", 3),
              rep("fmol/g liver/h", 2), rep("1 / h", 2),
              "L/nmol/h", rep("1 / h", 2), "fmol/mg protein",
              "", "nmol/L")



# Dataframe waar vector namen in de header komen, waarde namen als rijnamen 
# en de daadwerkelijke waarden daarin verwerkt.
model.conf <- data.frame(Waarden, Categorie, Eenheden)
# Tekenen van tabel
pander(model.conf)
```

Zoals eerder vermeld worden er twee situaties uitgewerkt. Er wordt allereerst gekeken naar de validiteit van het model. Hierbij worden een aantal vragen beantwoord. De antwoorden op de vragen bevinden zich in de resultaten sectie. Er moet wel veel verschuiving in de parameters plaatsvinden, dit wordt allemaal in de onderstaande alinea('s) weergegeven.

Hieronder staan de parameters die gebruikt zijn bij scenario één. Wat belangrijk is om op te merken
is dat D niet in de vectoren wordt verwerkt, omdat de concentraties in het onderzoek variëren
van 53.4 tot 39 (dosis 0.1) tot 107 (dosis 0.3). Als oplossing worden de concentraties direct aan functie ode() gegeven.

```{r}
# Definiëren van de parameters
parameters.1 <- c(Ks_Rm = 2.90, IC50_Rm = 26.2, 
                Kon = 0.00329, KT = 0.63, 
                Kre = 0.57, RF = 0.49, 
                Kd_R = 0.0572, Kd_Rm = 0.612, 
                Ksr = 3.22)
# 53.4
# Tijdspunten definiëren
times <- 0 : 200

# Het definiëren van de initiële waardes
initial.values.1 <- c(DR_N = 0, mRNAr = 4.74, R = 267, DR = 0)
```

Bij scenario twee (simulatie scenario's) zijn veel verschillende parameters gebruikt. Voor vraag 3 moet er worden gekeken wat er gebeurt bij een aanpassing van twee constantes. De aanpassing volgt hieronder. 

```{r}
# Kon / 5
parameters["Kon"] = 0.00329 / 5
dataset.kon.g5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kon / 2
parameters["Kon"] = 0.00329 / 2
dataset.kon.g2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kon * 5
parameters["Kon"] = 0.00329 * 5
dataset.kon.k5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kon * 2
parameters["Kon"] = 0.00329 * 2
dataset.kon.k2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre variabele
# Kre / 5
parameters["Kre"] = 0.57 / 5
dataset.kre.g5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre / 2
parameters["Kre"] = 0.57 / 2
dataset.kre.g2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre * 5
parameters["Kre"] = 0.57 * 5
dataset.kre.k5 <- ode(initial.values, times, verandering_dt, parameters, D = D)

# Kre * 2
parameters["Kre"] = 0.57 * 2
dataset.kre.k2 <- ode(initial.values, times, verandering_dt, parameters, D = D)

```

Bij vraag 4 van scenario twee, moet er een waarde in het model worden aangepast naar nul. Deze waarde is aangepast in de sectie bij het software model. 

Vraag 5 moet hier nog wel komen..........

# Resultaten

    Introduction of results, how does it answer your research questions.
    
Nog in te vullen...

```{r}
#plot(out)
#code to generate figures with title, subscripts, legenda etc
```

    - Describe what can be seen in such way that it leads to an answer to your research questions
    - Give your figures a number and a descriptive title.
    - Provide correct axis labels (unit and quantity), legend and caption.
    - Always refer to and discuss your figures and tables in the text - they never stand alone.

Nog in te vullen...

# Discussie en Conclusie

## Discussie

    - Compare your results with what is expecting from the literature and discuss differences with them.
    - Discuss striking and surprising results.
    - Discuss weaknesses in your research and how they could be addressed.
    
Nog in te vullen...

## Algemene conclusie en perspectief

    Discuss what your goal was, what the end result is and how you could continue working from here.

Nog in te vullen...

```{=tex}
\begin{thebibliography}{9}

\bibitem{deSolve}
Soetaert, K., Petzoldt, T., and Woodrow Setzer, R.: \textit{Solving differential equations in R: package deSolve}, J. Stat. Softw., 33, 1-25, 2010.

\bibitem{NCBI}
Bergmann MW, Staples KJ, Smith SJ, Barnes PJ, Newton R (2004).,
Am J Respir Cell Mol Biol 30: 555–563.: \textit{Glucocorticoids effects in degradation of mRNA}

\bibitem{pander}
Daróczi G, Tsegelskyi R (2022).: \textit{pander: An R 'Pandoc' Writer}. R package version 0.6.5, <https://CRAN.R-project.org/package=pander>.

\end{thebibliography}
```
